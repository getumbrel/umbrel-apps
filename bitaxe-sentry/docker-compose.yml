services:
  app_proxy:
    environment:
      APP_HOST: bitaxe-sentry_web_1
      APP_PORT: 7070
      
  sentry:
    image: zachprice105/bitaxe-sentry:v0.3.1@sha256:b2aad33a9e0b8b7d372a678c606a97d7dde9fcbf0b51bdd8f369dc1985be376a
    restart: on-failure
    stop_grace_period: 1m
    volumes:
      - ${APP_DATA_DIR}/data:/app/data
    environment:
      DB_PATH: "${DB_PATH:-/app/data/sentry.db}"
      POLL_INTERVAL_MINUTES: "${POLL_INTERVAL_MINUTES:-15}"
      RETENTION_DAYS: "${RETENTION_DAYS:-30}"
      TEMP_MIN: "${TEMP_MIN:-20}"
      TEMP_MAX: "${TEMP_MAX:-70}"
      VOLT_MIN: "${VOLT_MIN:-5.0}"
      BITAXE_ENDPOINTS: "${BITAXE_ENDPOINTS:-}"
      DISCORD_WEBHOOK_URL: "${DISCORD_WEBHOOK_URL:-}"
    
  web:
    image: zachprice105/bitaxe-sentry:v0.3.1@sha256:b2aad33a9e0b8b7d372a678c606a97d7dde9fcbf0b51bdd8f369dc1985be376a
    restart: on-failure
    stop_grace_period: 1m
    volumes:
      - ${APP_DATA_DIR}/data:/app/data
    command: uvicorn bitaxe_sentry.sentry.webapp:app --host 0.0.0.0 --port 7070
    environment:
      DB_PATH: "${DB_PATH:-/app/data/sentry.db}"
      POLL_INTERVAL_MINUTES: "${POLL_INTERVAL_MINUTES:-15}"
      RETENTION_DAYS: "${RETENTION_DAYS:-30}"
      TEMP_MIN: "${TEMP_MIN:-20}"
      TEMP_MAX: "${TEMP_MAX:-70}"
      VOLT_MIN: "${VOLT_MIN:-5.0}"
      BITAXE_ENDPOINTS: "${BITAXE_ENDPOINTS:-}"
      DISCORD_WEBHOOK_URL: "${DISCORD_WEBHOOK_URL:-}"
    depends_on:
      - sentry