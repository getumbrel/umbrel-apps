services:
  app_proxy:
    environment:
      APP_HOST: bitaxe-sentry_web_1
      APP_PORT: 7070

  sentry:
    image: zachprice105/bitaxe-sentry:v0.5.0@sha256:d1db5bc24b8c45347ab945747f5f8a1984ce966f0d902e801c6af76955368e8d
    user: "1000:1000"
    restart: on-failure
    stop_grace_period: 1m
    volumes:
      - ${APP_DATA_DIR}/data/sentry:/var/lib/bitaxe
    environment:
      DB_PATH: "/var/lib/bitaxe/bitaxe_sentry.db"
      DB_DATA_DIR: "/var/lib/bitaxe"

  web:
    image: zachprice105/bitaxe-sentry:v0.5.0@sha256:d1db5bc24b8c45347ab945747f5f8a1984ce966f0d902e801c6af76955368e8d
    user: "1000:1000"
    restart: on-failure
    stop_grace_period: 1m
    volumes:
      - ${APP_DATA_DIR}/data/sentry:/var/lib/bitaxe
    environment:
      DB_PATH: "/var/lib/bitaxe/bitaxe_sentry.db"
      DB_DATA_DIR: "/var/lib/bitaxe"
    command: uvicorn bitaxe_sentry.sentry.webapp:app --host 0.0.0.0 --port 7070
    depends_on:
      - sentry
