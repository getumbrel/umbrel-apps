version: '3.7'

services:
  app_proxy:
    environment:
      APP_HOST: fedimintd_fedimintd_1
      APP_PORT: 8175 # ui

  fedimintd:
    image: fedimint/fedimintd:v0.8.2@sha256:b191c3a5e9dfb8cbe6781fcfd4bade1669d8d3250280f7ecb638f8b394e8a5ca
    ports:
      - 8173:8173/tcp # p2p tls
      - 8173:8173/udp # p2p iroh
      - 8174:8174/udp # api iroh
    volumes:
      - ${APP_DATA_DIR}/data:/data
    environment:
      FM_ENABLE_IROH: "true"
      FM_DATA_DIR: "/data"
      FM_BITCOIN_NETWORK: ${APP_BITCOIN_NETWORK_ELECTRS}
      FM_BITCOIND_USERNAME: ${APP_BITCOIN_RPC_USER}
      FM_BITCOIND_PASSWORD: ${APP_BITCOIN_RPC_PASS}
      FM_BITCOIND_URL: "http://${APP_BITCOIN_NODE_IP}:${APP_BITCOIN_RPC_PORT}"
      FM_BIND_UI: 0.0.0.0:8175
    restart: on-failure
