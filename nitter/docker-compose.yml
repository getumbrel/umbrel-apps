services:
  app_proxy:
    environment:
      APP_HOST: $APP_NITTER_IP
      APP_PORT: 8080
      PROXY_AUTH_ADD: "false"

  web:
    # Official Nim image used as base image for nitter doesn't offer Arm variant so using a custom image
    # https://github.com/zedeus/nitter/issues/399#issuecomment-997263495
    image: quay.io/unixfox/nitter@sha256:87fd0349a3d3479bc6b9718441534d2f6b243d676de4ecf449ba66c3ed3ad345
    restart: on-failure
    stop_grace_period: 1m
    init: true
    # to pleb to figure out how to run non-root
    #user: "1000:1000"
    environment:
      REDIS_HOST: "redis"
    volumes:
      - ${APP_DATA_DIR}/data/nitter:/data
    entrypoint: /entrypoint.sh
    healthcheck:
      disable: true
    depends_on:
      - redis
    networks:
      default:
        ipv4_address: $APP_NITTER_IP
  redis:
    image: redis:6.2.2-buster@sha256:e10f55f92478715698a2cef97c2bbdc48df2a05081edd884938903aa60df6396
    user: "1000:1000"
    command: "redis-server --requirepass moneyprintergobrrr"
    restart: "on-failure"
    init: true
    stop_grace_period: 1m
    volumes:
      - ${APP_DATA_DIR}/data/redis:/data
    networks:
      default:
        ipv4_address: $APP_NITTER_REDIS_IP