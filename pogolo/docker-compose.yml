version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: pogolo_pogolo_1
      APP_PORT: 5663

  pogolo:
    image: 0xf0xx0/pogolo:v1.x@sha256:f98f732ec613bdca6d69421ef2e53234a70ff9b6a2450d807e81f6fb7be7cc2f
    restart: on-failure
    user: "1000:1000"
    stop_grace_period: 30s
    labels:
      - logopo
    ports:
      - 5661:5661 # stratum
      - 5662:5662 # api
    volumes:
      - "${APP_DATA_DIR}/data:/config:ro"
    environment:
      POGOLO_HOST: "0.0.0.0"
      POGOLO_BACKEND_HOST: "$APP_BITCOIN_NODE_IP:$APP_BITCOIN_RPC_PORT"
      POGOLO_BACKEND_RPCAUTH: "$APP_BITCOIN_RPC_USER:$APP_BITCOIN_RPC_PASS"
      # colorful logs
      FORCE_COLOR: 1

  widget-server:
    image: 0xf0xx0/umbrel-pogolo-widget:v1.0.0@sha256:4355198345deb2b6c7f6f38ad9ef5e91e3fbdc5e13d5465446fe89c968ecf852
    restart: on-failure
    user: "1000:1000"
    environment:
      POGOLO_API_URL: "http://pogolo_pogolo_1:5662"
