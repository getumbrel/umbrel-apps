version: "3.7"

services:

  app_proxy:
    environment:
      APP_HOST: influxdb_chronograf_1
      APP_PORT: 8888

  influxdb:
    image: influxdb:1.12.2@sha256:db03b9c599588cd5caded6df8b8258841017bf186898c6133a4f99b4d6134395
    user: 1000:1000
    restart: on-failure
    stop_grace_period: 1m
    volumes:
      - ${APP_DATA_DIR}/data/influxdb:/var/lib/influxdb
    environment:
      INFLUXDB_ADMIN_USER: admin
      INFLUXDB_ADMIN_PASSWORD: $APP_PASSWORD
      INFLUXDB_HTTP_AUTH_ENABLED: "true"

  chronograf:
    image: chronograf:1.10.8@sha256:42e7b310399e57126053f3ff8eb551290b942ebbd8fd08186af03cfce512bbff
    user: "1000:1000"
    environment:
      INFLUXDB_URL: "http://influxdb_influxdb_1:8086"
      INFLUXDB_USERNAME: admin
      INFLUXDB_PASSWORD: $APP_PASSWORD
    volumes:
      - ${APP_DATA_DIR}/data/chronograf:/var/lib/chronograf
    depends_on:
      - influxdb
