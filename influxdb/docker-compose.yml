version: "3.7"

services:
  
  app_proxy:
    environment:
      APP_HOST: influxdb_influxdb_1
      APP_PORT: 8886
      PROXY_AUTH_WHITELIST: "/api/*"
      
  influxdb:
    image: influxdb:1.11.8@sha256:7a7c698866b3c4098f70a6f9b5e55a10ae622e9cb02eaf48cf75c2f034877a8e
    user: 1000:1000
    restart: on-failure
    stop_grace_period: 1m
    volumes:
      - ${APP_DATA_DIR}/data:/var/lib/influxdb
    environment:
      INFLUXDB_ADMIN_USER: admin
      INFLUXDB_ADMIN_PASSWORD: admin
    ports:
      - "8886:8086" # InfluxDB port
      - "8088:8088" # RPC service for backup and restore

  chronograf:
    image: chronograf:1.9.4@sha256:928cd75952b597df3666886197cfdcd24a4017289422c0e12ec937c56f0131f4
    container_name: chronograf
    environment:
      INFLUXDB_URL: "http://influxdb_influxdb_1:8886"  # InfluxDB URL
    ports:
      - "8888:8888"  # Chronograf web interface port
    depends_on:
      - influxdb
