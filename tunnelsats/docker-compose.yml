version: '3.7'
services:
  tunnelsats:
    build: .
    image: tunnelsats/umbrel-app:latest
    container_name: tunnelsats
    restart: on-failure
    network_mode: "host"
    cap_add:
      - NET_ADMIN
      - NET_RAW
    security_opt:
      - apparmor:unconfined
    volumes:
      # Mount the app's persistent storage for configs
      - ${APP_DATA_DIR:-./data}:/data
      # Try to mount LN config directories to automate config insertion (graceful degradation if missing)
      - ${APP_DATA_DIR:-./data}/../lightning/data/lnd:/lightning-data/lnd
      - ${APP_DATA_DIR:-./data}/../core-lightning/data/lightningd/bitcoin:/lightning-data/cln
      # Required to interrogate container IPs dynamically (Umbrel 1.6+)
      - /var/run/docker.sock:/var/run/docker.sock:ro
